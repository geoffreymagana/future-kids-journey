# Visual Flow Diagrams: Duplicate Detection System

## 1. Form Submission Flow with Duplicate Detection

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     PARENT FORM SUBMISSION FLOW                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

FRONTEND (Browser)
==================

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  InterestFormSection Component   â”‚
    â”‚  - Form inputs (name, phone)     â”‚
    â”‚  - Validation (Zod schema)       â”‚
    â”‚  - sessionStorage tracking       â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â”‚ User submits form
                   â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Validate Form Data              â”‚
    â”‚  â”œâ”€ Name: min 2 chars            â”‚
    â”‚  â”œâ”€ Phone: valid number          â”‚
    â”‚  â””â”€ Age: valid range             â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â”‚ Valid data
                   â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Call API: POST /forms/submit     â”‚
    â”‚  {                               â”‚
    â”‚    name, whatsapp, ageRange      â”‚
    â”‚  }                               â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â”‚ Send to backend
                   â–¼

BACKEND (Server)
================

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Form Submission Endpoint        â”‚
    â”‚  POST /api/forms/submit          â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â”‚ Validate request
                   â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Query MongoDB                   â”‚
    â”‚  Find: {                         â”‚
    â”‚    whatsappNumber: "+254..."     â”‚
    â”‚    submittedAt: { $gte: 60s ago} â”‚
    â”‚  }                               â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ No match â”‚ Match found
        â–¼          â–¼
    NEW SUBMISSION   DUPLICATE FOUND
    â”œâ”€ isDuplicate: false    â”œâ”€ isDuplicate: true
    â”œâ”€ duplicateOf: null     â”œâ”€ duplicateOf: original_id
    â”œâ”€ Save to DB            â”œâ”€ Save to DB
    â””â”€ Return response       â”œâ”€ Mark original:
                             â”‚  â”œâ”€ hasDuplicates: true
                             â”‚  â””â”€ duplicateSubmissions: [new_id]
                             â””â”€ Return response


FRONTEND (Response Handling)
============================

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Receive API Response            â”‚
    â”‚  {                               â”‚
    â”‚    success: true,                â”‚
    â”‚    isDuplicate: [true|false]     â”‚
    â”‚  }                               â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                     â”‚
    isDuplicate=false  isDuplicate=true
        â”‚                     â”‚
        â–¼                     â–¼
    Show:                 Show:
    "Thank you!"          "We already have
    message               your info!"
        â”‚                     â”‚
        â”‚                     â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Store in sessionStorage         â”‚
    â”‚  {                               â”‚
    â”‚    whatsapp: "+254...",          â”‚
    â”‚    timestamp: Date.now()         â”‚
    â”‚  }                               â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Show Share Modal                â”‚
    â”‚  "Share your referral link"      â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ADMIN DASHBOARD
===============

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Submissions Table               â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ Parent Name â”‚ Phone â”‚ Duplicate  â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ John Smith  â”‚ 254... â”‚ âš ï¸ Has 1  â”‚ â† Original
    â”‚ John Smith  â”‚ 254... â”‚ ğŸ”„ Dup    â”‚ â† Duplicate
    â”‚ Jane Doe    â”‚ 254... â”‚ -         â”‚ â† No duplicates
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 2. Duplicate Detection Decision Tree

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  NEW FORM SUBMISSION RECEIVED                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Extract WhatsApp Number       â”‚
        â”‚  Extract Timestamp             â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Calculate: oneMinuteAgo       â”‚
        â”‚  = Now - 60000 milliseconds    â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Query MongoDB:                â”‚
        â”‚  whatsappNumber = given        â”‚
        â”‚  AND                           â”‚
        â”‚  submittedAt >= oneMinuteAgo   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                                 â”‚
   FOUND (0 results)              FOUND (1+ results)
        â”‚                                 â”‚
        â–¼                                 â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ NEW ENTRY   â”‚              â”‚ DUPLICATE ENTRY  â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚isDuplicate: â”‚              â”‚isDuplicate: true â”‚
   â”‚  false      â”‚              â”‚duplicateOf: orig â”‚
   â”‚             â”‚              â”‚                  â”‚
   â”‚Save to DB   â”‚              â”‚Save to DB        â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚Update original:  â”‚
        â”‚                       â”‚ hasDuplicates: âœ“ â”‚
        â”‚                       â”‚ add to array     â”‚
        â”‚                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                                 â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Return to Client:             â”‚
        â”‚  {                             â”‚
        â”‚    isDuplicate: [true|false],  â”‚
        â”‚    id: submission_id,          â”‚
        â”‚    message: "..."              â”‚
        â”‚  }                             â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 3. SessionStorage Management

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SESSION STORAGE: recentSubmissions                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Key: "recentSubmissions"
Value: JSON array of submissions

STRUCTURE:
[
  {
    whatsapp: "+254712345678",
    timestamp: 1699564800000  â† milliseconds
  },
  {
    whatsapp: "+254701234567",
    timestamp: 1699564860000  â† 60 seconds later
  }
]

LIFECYCLE:
1. On successful submission:
   â””â”€ storeSubmissionInSession() called
      â””â”€ Add new entry with current timestamp
      â””â”€ Filter out entries > 2 minutes old
      â””â”€ Save JSON back to sessionStorage

2. On next form submission:
   â””â”€ checkDuplicateInSession() called
      â””â”€ Read sessionStorage["recentSubmissions"]
      â””â”€ Parse JSON array
      â””â”€ Check for same whatsapp within 60 seconds
      â””â”€ Return true if found, false otherwise

3. Auto-cleanup:
   â””â”€ Runs on every submission
   â””â”€ Removes entries older than 2 minutes
   â””â”€ Prevents unbounded storage growth
   â””â”€ Typical size: < 200 bytes


EXAMPLES:

Submit 1: +254712345678 at 10:00:00
  sessionStorage: [{whatsapp: "+254712345678", timestamp: 1699564800000}]

Submit 2: +254712345678 at 10:00:30 (30 seconds later)
  Backend detects: isDuplicate = true
  sessionStorage: [
    {whatsapp: "+254712345678", timestamp: 1699564800000},
    {whatsapp: "+254712345678", timestamp: 1699564830000}
  ]

Submit 3: +254701234567 at 10:00:45 (different phone)
  Backend detects: isDuplicate = false
  sessionStorage: [
    {whatsapp: "+254712345678", timestamp: 1699564800000},
    {whatsapp: "+254712345678", timestamp: 1699564830000},
    {whatsapp: "+254701234567", timestamp: 1699564845000}
  ]

Wait 2 minutes...

Submit 4: +254712345678 at 10:02:01 (same phone after 121 seconds)
  SessionStorage cleanup:
    â””â”€ Remove entries < 120000ms old
    â””â”€ Only keep recent one (if any)
  Backend detects: isDuplicate = false (no recent match)
  sessionStorage: [
    {whatsapp: "+254712345678", timestamp: 1699564921000}
  ]
```

## 4. Admin Dashboard Duplicate Indicators

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ADMIN DASHBOARD: SUBMISSIONS TABLE                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Parent Name â”‚ Phone â”‚ Age â”‚ Date  â”‚ Source â”‚ Shared â”‚ Duplicate â”‚ ...  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¤
â”‚             â”‚       â”‚     â”‚       â”‚        â”‚        â”‚           â”‚      â”‚
â”‚ John Smith  â”‚ 254.. â”‚ 5-7 â”‚ 2/4   â”‚ Direct â”‚ 1      â”‚ âš ï¸ Has 2  â”‚ ...  â”‚
â”‚             â”‚       â”‚     â”‚       â”‚        â”‚        â”‚  (red)    â”‚      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¤
â”‚             â”‚       â”‚     â”‚       â”‚        â”‚        â”‚           â”‚      â”‚
â”‚ John Smith  â”‚ 254.. â”‚ 5-7 â”‚ 2/4   â”‚ Direct â”‚ 0      â”‚ ğŸ”„ Dup    â”‚ ...  â”‚
â”‚             â”‚       â”‚     â”‚       â”‚        â”‚        â”‚  (orange) â”‚      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¤
â”‚             â”‚       â”‚     â”‚       â”‚        â”‚        â”‚           â”‚      â”‚
â”‚ John Smith  â”‚ 254.. â”‚ 5-7 â”‚ 2/4   â”‚ Direct â”‚ 0      â”‚ ğŸ”„ Dup    â”‚ ...  â”‚
â”‚             â”‚       â”‚     â”‚       â”‚        â”‚        â”‚  (orange) â”‚      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¤
â”‚             â”‚       â”‚     â”‚       â”‚        â”‚        â”‚           â”‚      â”‚
â”‚ Jane Doe    â”‚ 254.. â”‚ 8-10â”‚ 2/3   â”‚ FB     â”‚ 2      â”‚ -         â”‚ ...  â”‚
â”‚             â”‚       â”‚     â”‚       â”‚        â”‚        â”‚  (gray)   â”‚      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¤


BADGE MEANINGS:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âš ï¸ HAS N (Red)                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ This is the ORIGINAL submission         â”‚
â”‚ N other submissions are duplicates      â”‚
â”‚ Shows count of detected duplicates      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ”„ DUPLICATE (Orange)                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ This submission is a DUPLICATE          â”‚
â”‚ Was submitted within 60 seconds         â”‚
â”‚ Can click to see original                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ - (Gray dash)                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ This submission has NO duplicate issues â”‚
â”‚ Is standalone or was original           â”‚
â”‚ No duplicates found for this phone      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 5. Data Relationships

```
ORIGINAL SUBMISSION
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ _id: 507f1f77bcf86cd799439011      â”‚
â”‚ parentName: "John Smith"            â”‚
â”‚ whatsappNumber: "+254712345678"     â”‚
â”‚ submittedAt: 2025-02-04 10:00:00    â”‚
â”‚                                     â”‚
â”‚ isDuplicate: false                  â”‚
â”‚ duplicateOf: null                   â”‚
â”‚ hasDuplicates: true âœ“               â”‚
â”‚ duplicateSubmissions: [             â”‚
â”‚   "507f1f77bcf86cd799439012",  â†â”€â”  â”‚
â”‚   "507f1f77bcf86cd799439013"   â†â”€â”¼â”€â”€â”¤
â”‚ ]                                 â”‚  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
       â–²                                  â”‚
       â”‚                                  â”‚
       â”‚ duplicateOf                      â”‚ hasDuplicates
       â”‚                                  â”‚
       â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ DUPLICATE 1      â”‚â—„â”€â”€â”€â”€â”˜
       â”‚         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
       â”‚         â”‚ _id: 507f...12   â”‚
       â”‚         â”‚ parentName: "JS" â”‚
       â”‚         â”‚ whatsapp: "+254.â”‚
       â”‚         â”‚ isDuplicate: âœ“   â”‚
       â”‚         â”‚ duplicateOf: ..11â”‚
       â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ DUPLICATE 2      â”‚
               â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
               â”‚ _id: 507f...13   â”‚
               â”‚ parentName: "JS" â”‚
               â”‚ whatsapp: "+254.â”‚
               â”‚ isDuplicate: âœ“   â”‚
               â”‚ duplicateOf: ..11â”‚
               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 6. Time-based Duplicate Detection Window

```
TIMELINE (60-second window)

t = 0:00:00
â”‚
â”œâ”€ [SUBMISSION 1] â† Original recorded
â”‚  Phone: +254712345678
â”‚  isDuplicate: false
â”‚
â”œâ”€ [SUBMISSION 2] at +0:00:30 â† Within 60s window
â”‚  Phone: +254712345678 (same)
â”‚  isDuplicate: true âœ“ (detected as duplicate)
â”‚
â”œâ”€ [SUBMISSION 3] at +0:00:59 â† Still within 60s window
â”‚  Phone: +254712345678 (same)
â”‚  isDuplicate: true âœ“ (detected as duplicate)
â”‚
â”œâ”€ [SUBMISSION 4] at +0:01:00 â† Exactly at 60s boundary
â”‚  Phone: +254712345678 (same)
â”‚  isDuplicate: false âœ— (outside window, allowed)
â”‚
â”œâ”€ [SUBMISSION 5] at +0:01:01 â† After 60s window
â”‚  Phone: +254712345678 (same)
â”‚  isDuplicate: false âœ— (allowed)
â”‚
â””â”€ [SUBMISSION 6] at +0:10:00 â† Much later
   Phone: +254712345678 (same)
   isDuplicate: false âœ— (allowed)


DETECTION FORMULA:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

if (submittedAt >= oneMinuteAgo) {
  isDuplicate = true;  â† Found recent match
} else {
  isDuplicate = false; â† No recent match
}

where:
  submittedAt = timestamp of matching submission
  oneMinuteAgo = currentTime - 60000 milliseconds
  >= = greater than or equal to (inclusive)
```

## 7. Complete Request/Response Lifecycle

```
REQUEST
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
POST /api/forms/submit
Content-Type: application/json

{
  "name": "John Smith",
  "whatsapp": "+254712345678",
  "ageRange": "5-7",
  "source": "direct"
}


BACKEND PROCESSING
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
1. Validate input with Zod schema
   âœ“ name: string, min 2 chars
   âœ“ whatsapp: string, min 10 chars
   âœ“ ageRange: enum ['5-7', '8-10', '11-14']
   âœ“ source: optional enum

2. Query MongoDB for recent submissions:
   db.form_submissions.findOne({
     whatsappNumber: "+254712345678",
     submittedAt: { $gte: ISODate("2025-02-04T09:59:00Z") }
   })

3. Decision:
   If found: isDuplicate = true, duplicateOf = found._id
   If not:   isDuplicate = false, duplicateOf = null

4. Create new submission document:
   {
     parentName: "John Smith",
     whatsappNumber: "+254712345678",
     childAgeRange: "5-7",
     source: "direct",
     isDuplicate: [true|false],
     duplicateOf: [ObjectId|null],
     submittedAt: ISODate("2025-02-04T10:00:00Z")
   }

5. If duplicate found:
   Update original submission:
   {
     $set: { hasDuplicates: true },
     $push: { duplicateSubmissions: newId }
   }


RESPONSE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
HTTP/1.1 201 Created
Content-Type: application/json

{
  "success": true,
  "message": "Form submitted successfully",
  "data": {
    "id": "507f1f77bcf86cd799439012",
    "isDuplicate": false,
    "message": "Thank you! We will be in touch soon."
  }
}

OR (if duplicate):

{
  "success": true,
  "message": "Form submitted successfully",
  "data": {
    "id": "507f1f77bcf86cd799439012",
    "isDuplicate": true,
    "message": "We already have your information. Thank you for your interest! We will reach out soon."
  }
}


FRONTEND HANDLING
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
1. Check response.data.isDuplicate
2. Show appropriate toast message
3. Store in sessionStorage:
   {
     whatsapp: "+254712345678",
     timestamp: Date.now()
   }
4. Navigate to share modal
5. User can share referral link
```

---

These diagrams provide complete visual understanding of the entire duplicate detection system.
